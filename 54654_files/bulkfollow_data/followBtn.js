var $Debug=(function(){var contentList=[];function add_to_content(sText,oOpts,sCMD){var key;var text=sText!=null?sText:"";var opts={color:null,bgcolor:null,html:null};var cmd=sCMD!=null?sCMD:"log";oOpts=oOpts!=null?oOpts:{};for(key in opts){if(oOpts[key]!=null){opts[key]=oOpts[key]}}contentList.push({label:text,cmd:cmd,opts:opts,time:new Date()})}function debug_proto(sText,oOpts){add_to_content(sText,oOpts,"log")}debug_proto.fatal=function(sText,oOpts){add_to_content(sText,oOpts,"fatal")};debug_proto.error=function(sText,oOpts){add_to_content(sText,oOpts,"error")};debug_proto.warning=function(sText,oOpts){add_to_content(sText,oOpts,"warning")};debug_proto.info=function(sText,oOpts){add_to_content(sText,oOpts,"info")};debug_proto.log=function(sText,oOpts){add_to_content(sText,oOpts,"log")};debug_proto.clear=function(){contentList=[]};debug_proto.contentList=contentList;return debug_proto})();var Jobs=(function(){var E=function(id){if(typeof id==="string"){return document.getElementById(id)}else{return id}};var addEvent=function(sNode,sEventType,oFunc){var oElement=E(sNode);if(oElement==null){return}sEventType=sEventType||"click";if((typeof oFunc).toLowerCase()!="function"){return}if(oElement.attachEvent){oElement.attachEvent("on"+sEventType,oFunc)}else{if(oElement.addEventListener){oElement.addEventListener(sEventType,oFunc,false)}else{oElement["on"+sEventType]=oFunc}}};var Ready=(function(){var funcList=[];var inited=false;var exec_func_list=function(){if(inited==true){return}inited=true;for(var i=0,len=funcList.length;i<len;i++){if((typeof funcList[i]).toLowerCase()=="function"){funcList[i].call()}}funcList=[]};if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if((/loaded|complete/).test(document.readyState)){exec_func_list()}});if(window==window.top){setTimeout(function(){try{document.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}exec_func_list()},500)}}else{if(document.addEventListener){addEvent(document,"DOMContentLoaded",exec_func_list)}else{if(/WebKit/i.test(navigator.userAgent)){(function(){if(/loaded|complete/i.test(document.readyState)){exec_func_list();return}setTimeout(arguments.callee,25)})()}}}addEvent(window,"load",exec_func_list);return function(oFunc){if(inited==false){funcList.push(oFunc)}else{if((typeof oFunc).toLowerCase()=="function"){oFunc.call()}}}})();function jobCls(){var regist_jobs_list={};var run_job_list=[];function start_event(){var run_index=0;var run_list_len=run_job_list.length;var jobName,jobFunc,startTime;(function(){if(run_list_len>run_index){jobName=run_job_list[run_index];jobFunc=regist_jobs_list[jobName];startTime=new Date();if(typeof jobFunc=="undefined"){$Debug.fatal("<b>Job ["+jobName+"] 未定义!</b>",{html:true});return}try{jobFunc.call()}catch(e){$Debug.fatal("<b>Job ["+jobName+"] 执行失败!</b><br/>&nbsp;"+e.name+"<br/>&nbsp;"+(e.message||e.description)+(e.fileName?"<br/>&nbsp;"+e.fileName:"")+(e.lineNumber?"<br/>&nbsp;"+e.lineNumber:""),{html:true})}finally{$Debug.info("<b>Job ["+jobName+"] 执行成功("+(new Date()-startTime)+"毫秒)</b>",{html:true})}run_index++;setTimeout(arguments.callee,25)}})()}this.regist=function(sJobName,oJobFunc){if(regist_jobs_list[sJobName]==null){regist_jobs_list[sJobName]=oJobFunc}run_job_list.push(sJobName)};Ready(start_event)}return new jobCls()})();if(!$CONFIG){$CONFIG={}}var scope=$CONFIG;Function.prototype.bind2=function(object){var __method=this;return function(){return __method.apply(object,arguments)}};scope.$VERSION="t3";scope.$BASEIMG="http://timg.sjs.sinajs.cn/"+scope.$VERSION+"/";scope.$BASECSS="http://timg.sjs.sinajs.cn/"+scope.$VERSION+"/";scope.$BASEJS="http://tjs.sjs.sinajs.cn/"+scope.$VERSION+"/";scope.$BASESTATIC="http://tjs.sjs.sinajs.cn/"+scope.$VERSION+"/";scope._ua=navigator.userAgent.toLowerCase();scope.$IE=/msie/.test(scope._ua);scope.$OPERA=/opera/.test(scope._ua);scope.$MOZ=/gecko/.test(scope._ua);scope.$IE5=/msie 5 /.test(scope._ua);scope.$IE55=/msie 5.5/.test(scope._ua);scope.$IE6=/msie 6/.test(scope._ua);scope.$IE7=/msie 7/.test(scope._ua);scope.$SAFARI=/safari/.test(scope._ua);scope.$winXP=/windows nt 5.1/.test(scope._ua);scope.$winVista=/windows nt 6.0/.test(scope._ua);var $IE=scope.$IE,$MOZ=scope.$MOZ,$IE6=scope.$IE6;function $import(url){}var Boot={};Boot.addDOMLoadEvent=function(func){if(!window.__load_events){var init=function(){if(arguments.callee.done){return}arguments.callee.done=true;if(window.__load_timer){clearInterval(window.__load_timer);window.__load_timer=null}for(var i=0;i<window.__load_events.length;i++){window.__load_events[i]()}window.__load_events=null};if(document.addEventListener){document.addEventListener("DOMContentLoaded",init,false)}if(/WebKit/i.test(navigator.userAgent)){window.__load_timer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){init()}},10)}if(window.ActiveXObject){window.__load_timer=setInterval(function(){try{document.body.doScroll("left");init()}catch(ex){}},10)}window.onload=init;window.__load_events=[]}window.__load_events.push(func)};Boot.getJsVersion=function(){var ver=false;if($CONFIG){ver=$CONFIG.js?$CONFIG.js:""}if(ver){return"?v="+ver}else{return""}};try{Boot.addDOMLoadEvent(main)}catch(e){}if(typeof Sina=="undefined"){Sina={}}Sina.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Sina;for(var i=(levels[0]=="Sina")?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};function $E(oID){var node=typeof oID=="string"?document.getElementById(oID):oID;if(node!=null){return node}else{}return null}function $C(tagName){return document.createElement(tagName)}function $N(name){return document.getElementsByName(name)}try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}if(typeof App=="undefined"){var App={}}Sina.pkg("Core");if(typeof Core=="undefined"){Core=Sina.Core}Sina.pkg("Core.Events");Core.Events.addEvent=function(elm,func,evType,useCapture){var _el=$E(elm);if(_el==null){$Debug("addEvent 找不到对象："+elm);return}if(typeof useCapture=="undefined"){useCapture=false}if(typeof evType=="undefined"){evType="click"}if(_el.addEventListener){_el.addEventListener(evType,func,useCapture);return true}else{if(_el.attachEvent){var r=_el.attachEvent("on"+evType,func);return true}else{_el["on"+evType]=func}}};Sina.pkg("Core.Base");(function(){var Detect=function(){var ua=navigator.userAgent.toLowerCase();this.$IE=/msie/.test(ua);this.$OPERA=/opera/.test(ua);this.$MOZ=/gecko/.test(ua);this.$IE5=/msie 5 /.test(ua);this.$IE55=/msie 5.5/.test(ua);this.$IE6=/msie 6/.test(ua);this.$IE7=/msie 7/.test(ua);this.$SAFARI=/safari/.test(ua);this.$winXP=/windows nt 5.1/.test(ua);this.$winVista=/windows nt 6.0/.test(ua);this.$FF2=/Firefox\/2/i.test(ua);this.$IOS=/\((iPhone|iPad|iPod)/i.test(ua)};Core.Base.detect=new Detect()})();Core.Events.getEvent=function(){return window.event};if(!Core.Base.detect.$IE){Core.Events.getEvent=function(){if(window.event){return window.event}var o=arguments.callee.caller;var e;var n=0;while(o!=null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent)){return e}n++;o=o.caller}return e}}Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();ev.cancelBubble=true;ev.returnValue=false};if(!$IE){Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();ev.preventDefault();ev.stopPropagation()}}Sina.pkg("Core.String");Core.String.byteLength=function(str){if(typeof str=="undefined"){return 0}var aMatch=str.match(/[^\x00-\x80]/g);return(str.length+(!aMatch?0:aMatch.length))};Sina.pkg("Core.Dom");Core.Dom.getElementsByClass=function(el,tg,clz){el=el||document;var rs=[];clz=" "+clz+" ";var cldr=el.getElementsByTagName(tg),len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];if(o.nodeType==1){var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}}return rs};Core.Dom.byClz=Core.Dom.getElementsByClass;Sina.pkg("Core.Array");Core.Array.foreach=function(ar,insp){if(ar==null&&ar.constructor!=Array){return[]}var i=0,len=ar.length,r=[];while(i<len){var x=insp(ar[i],i);if(x!==null){r[r.length]=x}i++}return r};Sina.pkg("Utils");if(typeof Utils=="undefined"){Utils=Sina.Utils}Sina.pkg("Utils.Io");Utils.Url=function(url){url=url||"";this.url=url;this.query={};this.parse()};Utils.Url.prototype={parse:function(url){if(url){this.url=url}this.parseAnchor();this.parseParam()},parseAnchor:function(){var anchor=this.url.match(/\#(.*)/);anchor=anchor?anchor[1]:null;this._anchor=anchor;if(anchor!=null){this.anchor=this.getNameValuePair(anchor);this.url=this.url.replace(/\#.*/,"")}},parseParam:function(){var query=this.url.match(/\?([^\?]*)/);query=query?query[1]:null;if(query!=null){this.url=this.url.replace(/\?([^\?]*)/,"");this.query=this.getNameValuePair(query)}},getNameValuePair:function(str){var o={};str.replace(/([^&=]*)(?:\=([^&]*))?/gim,function(w,n,v){if(n==""){return}o[n]=v||""});return o},getParam:function(sPara){return this.query[sPara]||""},clearParam:function(){this.query={}},setParam:function(name,value){if(name==null||name==""||typeof(name)!="string"){throw new Error("no param name set")}this.query=this.query||{};this.query[name]=value},setParams:function(o){this.query=o},serialize:function(o){var ar=[];for(var i in o){if(o[i]==null||o[i]==""){ar.push(i+"=")}else{ar.push(i+"="+o[i])}}return ar.join("&")},toString:function(){var queryStr=this.serialize(this.query);return this.url+(queryStr.length>0?"?"+queryStr:"")+(this.anchor?"#"+this.serialize(this.anchor):"")},getHashStr:function(forceSharp){return this.anchor?"#"+this.serialize(this.anchor):(forceSharp?"#":"")}};Core.String.encodeDoubleByte=function(str){if(typeof str!="string"){return str}return encodeURIComponent(str)};Utils.Io.Ajax={createRequest:function(){var request=null;try{request=new XMLHttpRequest()}catch(trymicrosoft){try{request=new ActiveXObject("Msxml2.XMLHTTP")}catch(othermicrosoft){try{request=ActiveXObject("Microsoft.XMLHTTP")}catch(failed){}}}if(request==null){$Debug.error("<b>create request failed</b>",{html:true})}else{return request}},request:function(url,option){option=option||{};option.onComplete=option.onComplete||function(){};option.onException=option.onException||function(){};option.onTimeout=option.onTimeout||function(){};option.timeout=option.timeout?option.timeout:-1;option.returnType=option.returnType||"txt";option.method=option.method||"get";option.data=option.data||{};if(typeof option.GET!="undefined"&&typeof option.GET.url_random!="undefined"&&option.GET.url_random==0){this.rand=false;option.GET.url_random=null}this.loadData(url,option)},loadData:function(url,option){var request=this.createRequest(),tmpArr=[];var _url=new Utils.Url(url);var timer;if(option.POST){for(var postkey in option.POST){var postvalue=option.POST[postkey];if(postvalue!=null){tmpArr.push(postkey+"="+Core.String.encodeDoubleByte(postvalue))}}}var sParameter=tmpArr.join("&")||"";if(option.GET){for(var key in option.GET){if(key!="url_random"){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}}if(this.rand!=false){_url.setParam("rnd",Math.random())}if(option.timeout>-1){timer=setTimeout(option.onTimeout,option.timeout)}request.onreadystatechange=function(){if(request.readyState==4){var response,type=option.returnType;try{switch(type){case"txt":response=request.responseText;break;case"xml":if(Core.Base.detect.$IE){response=request.responseXML}else{var Dparser=new DOMParser();response=Dparser.parseFromString(request.responseText,"text/xml")}break;case"json":response=eval("("+request.responseText+")");break}option.onComplete(response);clearTimeout(timer)}catch(e){option.onException(e.message,_url);return false}}};try{if(option.POST){request.open("POST",_url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.send(sParameter)}else{request.open("GET",_url,true);request.send(null)}}catch(e){option.onException(e.message,_url);return false}}};scope.loginKit=function(){var documentCookie=document.cookie+";";var supRegExp=["SUP","=([^;]*)?;"].join("");var uidRegExp=["(\\?|&)","uid","=([^&]*)(&|$)"].join("");var info=documentCookie.match(new RegExp(supRegExp,"i"));info=(info)?info[1]||"":"";info=unescape(info);var uid=info.match(new RegExp(uidRegExp));uid=(uid)?uid[2]||"":"";var oid=scope["$oid"];return{uid:uid,isLogin:!!uid,isAdmin:uid&&oid&&(uid==oid)}};scope.$isLogin=function(){return scope.loginKit().isLogin};scope.$isAdmin=function(){return scope.loginKit().isAdmin};var sysLang={zh_cn:{n001:"一键关注",n002:"请选择关注对象",n003:"已关注",n004:"请登录",n005:"开通微博",n006:"请重试"},zh_tw:{n001:"一鍵關注",n002:"請選擇關注對象",n003:"已關注",n004:"請登入",n005:"開通微博",n006:"請重試"}},Lang;Jobs.regist("Language_init",function(){Lang=sysLang[$CONFIG.$language?$CONFIG.$language:"zh_cn"]});Jobs.regist("base_init",function(){setTimeout(function(){App.setTextAlign()},10);var isLogin=scope.loginKit().isLogin;if(!isLogin&&$E("reg_btn")){$E("reg_btn").style.display=""}});App.setTextAlign=function(){var list=Core.Dom.getElementsByClass(null,"div","vf_info");Core.Array.foreach(list,function(el,i){var len=Core.String.byteLength(el.innerHTML);if(len*6>105){el.className="vf_info txt_left"}})};Jobs.regist("init_widget",function(){var $T=function(tag,con){return(con||document).getElementsByTagName(tag||"*")};var isChrome=/chrome/.test(navigator.userAgent.toLowerCase());scope.postLogin=0;var clearBtns=function(buttons){var temp=[],uids=[],uid,btn;for(var i=0,len=buttons.length;i<len;i++){btn=buttons[i];uid=btn.getAttribute("uid");if(uid){temp.push(btn);uids.push(uid)}}uids=encodeURIComponent(uids.join(",")||"");var $uid=scope.loginKit().uid;var img=new Image();img.src="http://rs.sinajs.cn/a.gif?uid="+$uid+"&uids="+uids+"&refer="+(scope.refer||"")+"&ch="+(scope.ch||"")+"&rnd="+new Date().valueOf();return temp};var panel=$T("ul")[0],btns=$T("span",panel),is_input=false;if(btns.length==0){is_input=true;btns=$T("input",panel)}var uBtns=clearBtns($T("a",panel));Core.Array.foreach(btns,function(btn,i){var user=uBtns[i];if(is_input){btn.checked=(user.className=="current")}Core.Events.addEvent(btn,function(){if(!is_input){Core.Events.stopEvent();user.className=(user.className=="")?"current":""}else{user.className=btn.checked?"current":""}if(user.className=="current"){App.showFollowBtn()}},"click")});panel=btns=clearBtns=null;App.showFollowBtn=function(){};App.followAll=function(btn){if(!scope.loginKit().isLogin){App.loginIframe(btn);return}var uids=[];Core.Array.foreach(uBtns,function(el,i){if(el.className=="current"){uids.push(el.getAttribute("uid"))}});var pNod=btn&&btn.parentNode;var err=function(msg,bclk){if(pNod){pNod.innerHTML="<span "+(bclk?'onclick="App.followAll( this );"':"")+' class="btndisable_l concern_done"><em>'+msg+"</em></span>"}};App.showFollowBtn=function(){if(pNod){pNod.innerHTML='<a onclick="App.followAll( this );" href="javascript:;" class="btngreen_l"><em><span>'+Lang.n001+"</span></em></a>"}};if(uids.length==0){err(Lang.n002);return}if(btn&&btn.tagName.toLocaleLowerCase()=="a"){var span=btn.getElementsByTagName("span")[0];if(span){span.className="ico_lding";btn.className="btngreen_l btngreen_l_wdt1"}}var weiboURL="/widget/relationship/aj_follow.php";if(/weibo.com/.test(location.host)){weiboURL=weiboURL.replace(/\/widget/,"")}Utils.Io.Ajax.request(weiboURL,{POST:{uids:uids.join(","),appkey:scope.$appkey,login:scope.postLogin,ch:scope.ch||"",refer:scope.refer||""},onComplete:function(json){var code=json&&json.code;if(code=="A00006"){err(Lang.n003);App.sendSUDA("loginfollow:::"+uids.join(","))}else{if(code=="M00005"){err(Lang.n004,true);if(!isChrome){try{App.loginIframe(pNod.getElementsByTagName("a")[0])}catch(e){}}}else{if(code=="M00006"){if(pNod){pNod.innerHTML='<a class="btngreen_l" href="javascript:;" onclick="App.loginIframe( this );" user_count="widget_bulkfollow_fullinfo"><em><span>'+Lang.n005+"</span></em></a>"}if(!isChrome){try{App.loginIframe(pNod.getElementsByTagName("a")[0])}catch(e){}}}else{var msg=json&&json.data||Lang.n006;err(msg,true)}}}},onException:function(e1){err(Lang.n006,true)},returnType:"json"})};App.loginIframe=function(btn){App.loginBackUrlCallBack=function(){var uid=scope.loginKit().uid;(new Image()).src="http://rs.sinajs.cn/r.gif?uid="+uid+"&appid="+$CONFIG.$appkey;App.followAll(btn)};scope.postLogin=1;var url="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl=http%3A%2F%2F"+location.host+"%2Fstaticjs%2FloginProxy.html&vsrc=app_bulkfollow&appsrc="+scope.$appsrc+"&showlogo=0&rnd="+(new Date().valueOf());if(/weibo.com/.test(location.host)){url=url.replace(/\/widget/,"")}if(scope.$spr){url+="&c="+scope.$spr}var loginPopWindow=window.open(url,"miniblog_login",["toolbar=0,status=0,resizable=1,width=620,height=540,left=",(screen.width-620)/2,",top=",(screen.height-450)/2].join(""));loginPopWindow.focus()};try{var ul=Core.Dom.getElementsByClass(null,"ul","t_user_lst")[0];var w=ul.parentNode.offsetWidth-2-14;var list=ul.getElemensByTagName("li");if((w/86)>=list.length){var margin=(w%86)/2>>0;if(margin<7){return}ul.style.margin="0 "+margin+"px"}}catch(e){}});App.sudaCount=function(uid){App.sendSUDA("click_"+uid)};App.sendSUDA=function(key){try{GB_SUDA._S_uaTrack("weibo_bulkfollow_widget",key)}catch(e){}};